<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="è¾“å…¥æ³•,">










<meta name="description" content="iOSä¸‹è‡ªå®šä¹‰é”®ç›˜çš„åˆ›å»ºæ–¹æ³•åœ¨ã€ŠCustom Keyboardï¼ˆè¯‘ï¼‰ã€‹ä¸­æœ‰è¯¦ç»†æè¿°ï¼Œå®ƒç”Ÿæˆçš„é”®ç›˜åªæ˜¯ä¸€ä¸ªç™½æ¿ã€‚è¿™é‡Œæˆ‘ä»¬ç»§ç»­æŠŠå®ƒå®Œå–„æˆä¸ºä¸€ä¸ªè¾“å…¥æ³•çš„æ ·å­ã€‚">
<meta name="keywords" content="è¾“å…¥æ³•">
<meta property="og:type" content="article">
<meta property="og:title" content="iOSä¸‹å¼€å‘Custom Keyboard">
<meta property="og:url" content="http://palanceli.github.io/2017/03/11/2017/0311iOSCKImeSample/index.html">
<meta property="og:site_name" content="Palance&#39;s Blog">
<meta property="og:description" content="iOSä¸‹è‡ªå®šä¹‰é”®ç›˜çš„åˆ›å»ºæ–¹æ³•åœ¨ã€ŠCustom Keyboardï¼ˆè¯‘ï¼‰ã€‹ä¸­æœ‰è¯¦ç»†æè¿°ï¼Œå®ƒç”Ÿæˆçš„é”®ç›˜åªæ˜¯ä¸€ä¸ªç™½æ¿ã€‚è¿™é‡Œæˆ‘ä»¬ç»§ç»­æŠŠå®ƒå®Œå–„æˆä¸ºä¸€ä¸ªè¾“å…¥æ³•çš„æ ·å­ã€‚">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://palanceli.github.io/2017/03/11/2017/0311iOSCKImeSample/img01.png">
<meta property="og:image" content="http://palanceli.github.io/2017/03/11/2017/0311iOSCKImeSample/img02.png">
<meta property="og:image" content="http://palanceli.github.io/2017/03/11/2017/0311iOSCKImeSample/img03.png">
<meta property="og:updated_time" content="2019-08-14T03:46:28.811Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOSä¸‹å¼€å‘Custom Keyboard">
<meta name="twitter:description" content="iOSä¸‹è‡ªå®šä¹‰é”®ç›˜çš„åˆ›å»ºæ–¹æ³•åœ¨ã€ŠCustom Keyboardï¼ˆè¯‘ï¼‰ã€‹ä¸­æœ‰è¯¦ç»†æè¿°ï¼Œå®ƒç”Ÿæˆçš„é”®ç›˜åªæ˜¯ä¸€ä¸ªç™½æ¿ã€‚è¿™é‡Œæˆ‘ä»¬ç»§ç»­æŠŠå®ƒå®Œå–„æˆä¸ºä¸€ä¸ªè¾“å…¥æ³•çš„æ ·å­ã€‚">
<meta name="twitter:image" content="http://palanceli.github.io/2017/03/11/2017/0311iOSCKImeSample/img01.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://palanceli.github.io/2017/03/11/2017/0311iOSCKImeSample/">





  <title>iOSä¸‹å¼€å‘Custom Keyboard | Palance's Blog</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?e9c9a05f15583e8039e36cfe85103e96";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script><!-- hexo-inject:begin --><!-- hexo-inject:end -->




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Palance's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            å…³äº
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            å½’æ¡£
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://palanceli.github.io/2017/03/11/2017/0311iOSCKImeSample/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Palance Li">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/13184524">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Palance's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">iOSä¸‹å¼€å‘Custom Keyboard</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-03-11T23:33:00+08:00">
                2017-03-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/éšç¬”ç¬”è®°/" itemprop="url" rel="index">
                    <span itemprop="name">éšç¬”ç¬”è®°</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/03/11/2017/0311iOSCKImeSample/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/03/11/2017/0311iOSCKImeSample/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>iOSä¸‹è‡ªå®šä¹‰é”®ç›˜çš„åˆ›å»ºæ–¹æ³•åœ¨<a href="http://palanceli.com/2017/03/07/2017/0307CustomKeyboard/#ä½¿ç”¨Xcodeè‡ªå®šä¹‰é”®ç›˜æ¨¡æ¿" target="_blank" rel="noopener">ã€ŠCustom Keyboardï¼ˆè¯‘ï¼‰ã€‹</a>ä¸­æœ‰è¯¦ç»†æè¿°ï¼Œå®ƒç”Ÿæˆçš„é”®ç›˜åªæ˜¯ä¸€ä¸ªç™½æ¿ã€‚è¿™é‡Œæˆ‘ä»¬ç»§ç»­æŠŠå®ƒå®Œå–„æˆä¸ºä¸€ä¸ªè¾“å…¥æ³•çš„æ ·å­ã€‚<a id="more"></a><br>é¡¹ç›®çš„åç§°ä¸º<code>iOSCKImeSample</code>ï¼Œè¿™ä¹Ÿæ˜¯å®¹å™¨appçš„åå­—ã€‚é”®ç›˜çš„Target nameä¸º<code>CKbd</code>ã€‚</p>
<h1 id="åœ¨å®¹å™¨appä¸­æ·»åŠ å¯è¾“å…¥å¯¹è±¡"><a href="#åœ¨å®¹å™¨appä¸­æ·»åŠ å¯è¾“å…¥å¯¹è±¡" class="headerlink" title="åœ¨å®¹å™¨appä¸­æ·»åŠ å¯è¾“å…¥å¯¹è±¡"></a>åœ¨å®¹å™¨appä¸­æ·»åŠ å¯è¾“å…¥å¯¹è±¡</h1><p>å¦‚å›¾ï¼Œåœ¨å®¹å™¨appä¸­æ·»åŠ ä¸¤ä¸ªæ§ä»¶ï¼Œä»¥ä¾¿éªŒè¯é”®ç›˜ï¼š<br><img src="/2017/03/11/2017/0311iOSCKImeSample/img01.png" alt="æ·»åŠ è¾“å…¥æ§ä»¶"></p>
<h1 id="Xcodeæ¨¡æ¿ç”Ÿæˆçš„é”®ç›˜"><a href="#Xcodeæ¨¡æ¿ç”Ÿæˆçš„é”®ç›˜" class="headerlink" title="Xcodeæ¨¡æ¿ç”Ÿæˆçš„é”®ç›˜"></a>Xcodeæ¨¡æ¿ç”Ÿæˆçš„é”®ç›˜</h1><p>å…ˆæ¥çœ‹çœ‹Xcodeé»˜è®¤ç”Ÿæˆçš„è¾“å…¥æ³•çš„æ ·å­ï¼š<br><img src="/2017/03/11/2017/0311iOSCKImeSample/img02.png" alt="Xcodeé»˜è®¤ç”Ÿæˆçš„é”®ç›˜"><br>åœ¨<code>iOSCKImeSampleCKbd/KeyboardViewController.m</code>ä¸­ï¼Œ<br><code>KeyboardViewController::viewDidLoad</code>ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">  [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ç”Ÿæˆæ–¹å½¢åœ†è§’æŒ‰é’®</span></span><br><span class="line">  <span class="keyword">self</span>.nextKeyboardButton = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeSystem</span>];</span><br><span class="line">  <span class="comment">// è®¾ç½®æ ‡é¢˜ï¼Œå’ŒçŠ¶æ€</span></span><br><span class="line">  [<span class="keyword">self</span>.nextKeyboardButton setTitle:</span><br><span class="line">   <span class="built_in">NSLocalizedString</span>(<span class="string">@"Next Keyboard"</span>,</span><br><span class="line">                     <span class="string">@"Title for 'Next Keyboard' button"</span>)</span><br><span class="line">                           forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">  <span class="comment">// æŒ‰é’®å°ºå¯¸ä¸ºèƒ½å®¹çº³å†…å®¹çš„æœ€å°åŒ–å°ºå¯¸</span></span><br><span class="line">  [<span class="keyword">self</span>.nextKeyboardButton sizeToFit];</span><br><span class="line">  <span class="keyword">self</span>.nextKeyboardButton.translatesAutoresizingMaskIntoConstraints = <span class="literal">NO</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// è®¾ç½®å“åº”ï¼šé•¿æŒ‰æ˜¾ç¤ºè¾“å…¥æ³•åˆ—è¡¨ï¼ŒçŸ­æŒ‰åˆ‡æ¢è¾“å…¥æ³•</span></span><br><span class="line">  [<span class="keyword">self</span>.nextKeyboardButton addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(handleInputModeListFromView:withEvent:) forControlEvents:<span class="built_in">UIControlEventAllTouchEvents</span>];</span><br><span class="line">  <span class="comment">// å°†æŒ‰é’®æ·»åŠ ä¸ºviewçš„å­è§†å›¾</span></span><br><span class="line">  [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.nextKeyboardButton];</span><br><span class="line">  <span class="comment">// å°†æŒ‰é’®å·¦/ä¸‹è¾¹ç¼˜å¯¹é½åˆ°viewçš„å·¦ä¸‹è¾¹ç¼˜</span></span><br><span class="line">  [<span class="keyword">self</span>.nextKeyboardButton.leftAnchor constraintEqualToAnchor:<span class="keyword">self</span>.view.leftAnchor].active = <span class="literal">YES</span>;</span><br><span class="line">  [<span class="keyword">self</span>.nextKeyboardButton.bottomAnchor constraintEqualToAnchor:<span class="keyword">self</span>.view.bottomAnchor].active = <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å®ƒç›´æ¥åœ¨ä¸»è§†å›¾ä¸Šç”Ÿæˆäº†ä¸€ä¸ª<code>Next Keyboard</code>æŒ‰é’®ï¼Œå¹¶å“åº”ç‚¹å‡»äº‹ä»¶ã€‚å®Œå–„è¯¥é”®ç›˜ï¼Œåªéœ€è¦åœ¨ä¸»è§†å›¾ä¸Šé•¿å‡ºå®Œæ•´çš„é”®ç›˜æŒ‰é’®ï¼Œå¹¶å“åº”ç‚¹å‡»äº‹ä»¶å³å¯ã€‚</p>
<h1 id="Step1-åˆ›å»ºæŒ‰é”®å¸ƒå±€"><a href="#Step1-åˆ›å»ºæŒ‰é”®å¸ƒå±€" class="headerlink" title="Step1 åˆ›å»ºæŒ‰é”®å¸ƒå±€"></a>Step1 åˆ›å»ºæŒ‰é”®å¸ƒå±€</h1><p>ä¸º<code>KeyboardViewController</code>æ·»åŠ å‡½æ•°<code>createCKbdUI</code>ï¼Œå¹¶åœ¨<code>KeyboardViewController::viewDidLoad</code>ä¸­è°ƒç”¨å®ƒï¼š<br><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">  [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">  [<span class="keyword">self</span> createCKbdUI]; <span class="comment">// åˆ›å»ºé”®ç›˜å¸ƒå±€</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Step1-1-createCKbdUI"><a href="#Step1-1-createCKbdUI" class="headerlink" title="Step1.1 createCKbdUI"></a>Step1.1 createCKbdUI</h2><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)createCKbdUI&#123;</span><br><span class="line">  <span class="keyword">self</span>.allButtons= [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">  <span class="keyword">self</span>.isPressShiftKey= <span class="literal">NO</span>;</span><br><span class="line">  <span class="comment">// å®šä¹‰æ¯ä¸€è¡Œçš„é”®å¸½å­—ç¬¦</span></span><br><span class="line">  <span class="built_in">NSArray</span> *titles = @[@[<span class="string">@"q"</span>,<span class="string">@"w"</span>,<span class="string">@"e"</span>,<span class="string">@"r"</span>,<span class="string">@"t"</span>,<span class="string">@"y"</span>,<span class="string">@"u"</span>,<span class="string">@"i"</span>,<span class="string">@"o"</span>,<span class="string">@"p"</span>],</span><br><span class="line">                      @[<span class="string">@"a"</span>,<span class="string">@"s"</span>,<span class="string">@"d"</span>,<span class="string">@"f"</span>,<span class="string">@"g"</span>,<span class="string">@"h"</span>,<span class="string">@"j"</span>,<span class="string">@"k"</span>,<span class="string">@"l"</span>],</span><br><span class="line">                      @[<span class="string">@"shift"</span>,<span class="string">@"z"</span>,<span class="string">@"x"</span>,<span class="string">@"c"</span>,<span class="string">@"v"</span>,<span class="string">@"b"</span>,<span class="string">@"n"</span>,<span class="string">@"m"</span>,<span class="string">@"bksp"</span>],</span><br><span class="line">                      @[<span class="string">@"123"</span>,<span class="string">@"next"</span>,<span class="string">@"space"</span>,<span class="string">@"return"</span>]];</span><br><span class="line">  <span class="comment">// ä¸ºæ¯ä¸€è¡Œåˆ›å»ºè§†å›¾ï¼Œå¹¶åŠ å…¥ä¸»è§†å›¾</span></span><br><span class="line">  <span class="built_in">NSMutableArray</span> *rowViews = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">  <span class="keyword">for</span>(<span class="built_in">NSArray</span> *rowTitle <span class="keyword">in</span> titles)&#123;</span><br><span class="line">    <span class="built_in">UIView</span>* view = [<span class="keyword">self</span> createRowOfButtons:rowTitle]; <span class="comment">// ğŸ</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:view];</span><br><span class="line">    [rowViews addObject:view];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ä¸ºæ¯è¡Œè§†å›¾æ·»åŠ çº¦æŸ</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="built_in">UIView</span> *rowView <span class="keyword">in</span> rowViews) &#123;</span><br><span class="line">    <span class="built_in">NSInteger</span> index = [rowViews indexOfObject:rowView];</span><br><span class="line">    rowView.translatesAutoresizingMaskIntoConstraints = <span class="literal">NO</span>;</span><br><span class="line">    <span class="comment">// å·¦å³éƒ½ä¸ä¸»è§†å›¾çš„å·¦å³è¾¹ç¼˜å¯¹é½</span></span><br><span class="line">    <span class="built_in">NSLayoutConstraint</span> *rightConstraint = [<span class="built_in">NSLayoutConstraint</span></span><br><span class="line">                                           constraintWithItem:rowView</span><br><span class="line">                                           attribute:<span class="built_in">NSLayoutAttributeRight</span></span><br><span class="line">                                           relatedBy:<span class="built_in">NSLayoutRelationEqual</span></span><br><span class="line">                                           toItem:<span class="keyword">self</span>.view</span><br><span class="line">                                           attribute:<span class="built_in">NSLayoutAttributeRight</span></span><br><span class="line">                                           multiplier:<span class="number">1.0</span> constant:<span class="number">0</span>];</span><br><span class="line">    <span class="built_in">NSLayoutConstraint</span> *leftConstraint = [<span class="built_in">NSLayoutConstraint</span></span><br><span class="line">                                          constraintWithItem:rowView</span><br><span class="line">                                          attribute:<span class="built_in">NSLayoutAttributeLeft</span></span><br><span class="line">                                          relatedBy:<span class="built_in">NSLayoutRelationEqual</span></span><br><span class="line">                                          toItem:<span class="keyword">self</span>.view</span><br><span class="line">                                          attribute:<span class="built_in">NSLayoutAttributeLeft</span></span><br><span class="line">                                          multiplier:<span class="number">1.0</span> constant:<span class="number">0</span>];</span><br><span class="line">    <span class="comment">// é¦–è¡Œviewä¸ä¸»è§†å›¾ä¸Šè¾¹ç¼˜å¯¹é½ï¼Œä¹‹åçš„ä¸ä¸Šé‚»viewä¸‹è¾¹ç¼˜å¯¹é½</span></span><br><span class="line">    <span class="keyword">id</span> toItem = <span class="keyword">self</span>.view;</span><br><span class="line">    <span class="built_in">NSLayoutAttribute</span> toItemAttribute = <span class="built_in">NSLayoutAttributeTop</span>;</span><br><span class="line">    <span class="keyword">if</span>(index &gt; <span class="number">0</span>)&#123;</span><br><span class="line">      toItem = rowViews[index - <span class="number">1</span>];</span><br><span class="line">      toItemAttribute = <span class="built_in">NSLayoutAttributeBottom</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">NSLayoutConstraint</span> *topConstraint = [<span class="built_in">NSLayoutConstraint</span></span><br><span class="line">                                         constraintWithItem:rowView</span><br><span class="line">                                         attribute:<span class="built_in">NSLayoutAttributeTop</span></span><br><span class="line">                                         relatedBy:<span class="built_in">NSLayoutRelationEqual</span></span><br><span class="line">                                         toItem:toItem</span><br><span class="line">                                         attribute:toItemAttribute</span><br><span class="line">                                         multiplier:<span class="number">1.0</span> constant:<span class="number">0</span>];</span><br><span class="line">    <span class="comment">// æœ«è¡Œviewä¸ä¸»è§†å›¾ä¸‹è¾¹ç¼˜å¯¹é½ï¼Œä¹‹å‰çš„ä¸ä¸‹é‚»viewä¸Šè¾¹ç¼˜å¯¹é½</span></span><br><span class="line">    toItem = <span class="keyword">self</span>.view;</span><br><span class="line">    toItemAttribute = <span class="built_in">NSLayoutAttributeBottom</span>;</span><br><span class="line">    <span class="keyword">if</span>(index &lt; rowViews.count - <span class="number">1</span>)&#123;</span><br><span class="line">      toItem = rowViews[index +<span class="number">1</span>];</span><br><span class="line">      toItemAttribute = <span class="built_in">NSLayoutAttributeTop</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">NSLayoutConstraint</span> *buttomConstraint = [<span class="built_in">NSLayoutConstraint</span></span><br><span class="line">                                            constraintWithItem:rowView</span><br><span class="line">                                            attribute:<span class="built_in">NSLayoutAttributeBottom</span></span><br><span class="line">                                            relatedBy:<span class="built_in">NSLayoutRelationEqual</span></span><br><span class="line">                                            toItem:toItem</span><br><span class="line">                                            attribute:toItemAttribute</span><br><span class="line">                                            multiplier:<span class="number">1.0</span> constant:<span class="number">0</span>];</span><br><span class="line">    <span class="comment">// ç­‰é«˜çº¦æŸ</span></span><br><span class="line">    <span class="built_in">UIView</span> *firstRow = rowViews[<span class="number">0</span>];</span><br><span class="line">    <span class="built_in">NSLayoutConstraint</span> *heightConstraint = [<span class="built_in">NSLayoutConstraint</span></span><br><span class="line">                                            constraintWithItem:firstRow</span><br><span class="line">                                            attribute:<span class="built_in">NSLayoutAttributeHeight</span></span><br><span class="line">                                            relatedBy:<span class="built_in">NSLayoutRelationEqual</span></span><br><span class="line">                                            toItem:rowView</span><br><span class="line">                                            attribute:<span class="built_in">NSLayoutAttributeHeight</span></span><br><span class="line">                                            multiplier:<span class="number">1.0</span></span><br><span class="line">                                            constant:<span class="number">0</span>];</span><br><span class="line">    [<span class="keyword">self</span>.view addConstraint:heightConstraint];</span><br><span class="line">    [<span class="keyword">self</span>.view addConstraints:@[leftConstraint,rightConstraint,topConstraint,buttomConstraint]];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Step1-2-createRowOfButtons"><a href="#Step1-2-createRowOfButtons" class="headerlink" title="Step1.2 createRowOfButtons"></a>Step1.2 createRowOfButtons</h2><p>æ ¹æ®buttonTitlesåˆ›å»ºåŒ…å«ä¸€æ’æŒ‰é”®çš„è§†å›¾<br><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">UIView</span>* )createRowOfButtons:(<span class="built_in">NSArray</span>*)buttonTitles&#123;</span><br><span class="line">  <span class="comment">// ä¸ºæ¯è¡ŒæŒ‰é”®åˆ›å»ºä¸€ä¸ªview</span></span><br><span class="line">  <span class="built_in">UIView</span> *keyBoardRowView = [[<span class="built_in">UIView</span> alloc]initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">320</span>, <span class="number">50</span>)];</span><br><span class="line">  </span><br><span class="line">  <span class="built_in">NSMutableArray</span> *buttons = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">  <span class="comment">//éå†titleï¼Œä¾æ¬¡åˆ›å»ºæŒ‰é”®ï¼Œå¹¶åŠ å…¥åˆ°keyBoardRowView</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="built_in">NSString</span> *title <span class="keyword">in</span> buttonTitles) &#123;</span><br><span class="line">    <span class="built_in">UIButton</span> *btn = [<span class="built_in">UIButton</span> buttonWithType:(<span class="built_in">UIButtonTypeSystem</span>)];</span><br><span class="line">    btn.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">20</span>, <span class="number">30</span>);</span><br><span class="line">    [btn setTitle:title forState:(<span class="built_in">UIControlStateNormal</span>)];</span><br><span class="line">    [btn sizeToFit];</span><br><span class="line">    [btn.layer setBorderWidth:<span class="number">1.0</span>];</span><br><span class="line">    btn.titleLabel.font = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">15</span>];</span><br><span class="line">    [btn setTranslatesAutoresizingMaskIntoConstraints:<span class="literal">false</span>];</span><br><span class="line">    [btn setTitleColor:[<span class="built_in">UIColor</span> darkGrayColor]</span><br><span class="line">              forState:(<span class="built_in">UIControlStateNormal</span>)];</span><br><span class="line">    <span class="comment">// æŒ‡å®šå“åº”å‡½æ•°</span></span><br><span class="line">    [btn addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(didTapButton:)</span><br><span class="line">              forControlEvents:(<span class="built_in">UIControlEventTouchUpInside</span>)]; <span class="comment">// ğŸ</span></span><br><span class="line">    [buttons addObject:btn];</span><br><span class="line">    [<span class="keyword">self</span>.allButtons addObject:btn];</span><br><span class="line">    [keyBoardRowView addSubview:btn];</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// éå†æ¯ä¸€ä¸ªæŒ‰é”®ï¼Œè®¾ç½®çº¦æŸ</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="built_in">UIButton</span> *button <span class="keyword">in</span> buttons) &#123;</span><br><span class="line">    <span class="built_in">NSInteger</span> space = <span class="number">1</span>; <span class="comment">// è¾¹è·</span></span><br><span class="line">    <span class="built_in">NSInteger</span> index = [buttons indexOfObject:button];</span><br><span class="line">    <span class="comment">//å…³é—­buttonè‡ªåŠ¨ç¿»è¯‘çº¦æŸçš„åŠŸèƒ½</span></span><br><span class="line">    button.translatesAutoresizingMaskIntoConstraints = <span class="literal">NO</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// button é¡¶éƒ¨ä¸keyboardViewé¡¶éƒ¨å¯¹é½</span></span><br><span class="line">    <span class="built_in">NSLayoutConstraint</span> *topConstraint = [<span class="built_in">NSLayoutConstraint</span></span><br><span class="line">                                         constraintWithItem:button</span><br><span class="line">                                         attribute:<span class="built_in">NSLayoutAttributeTop</span></span><br><span class="line">                                         relatedBy:<span class="built_in">NSLayoutRelationEqual</span></span><br><span class="line">                                         toItem:keyBoardRowView</span><br><span class="line">                                         attribute:<span class="built_in">NSLayoutAttributeTop</span></span><br><span class="line">                                         multiplier:<span class="number">1.0</span></span><br><span class="line">                                         constant:space];</span><br><span class="line">    <span class="comment">// button åº•éƒ¨ä¸keyboardViewåº•éƒ¨å¯¹é½</span></span><br><span class="line">    <span class="built_in">NSLayoutConstraint</span> *bottomConstraint = [<span class="built_in">NSLayoutConstraint</span></span><br><span class="line">                                            constraintWithItem:button</span><br><span class="line">                                            attribute:<span class="built_in">NSLayoutAttributeBottom</span></span><br><span class="line">                                            relatedBy:<span class="built_in">NSLayoutRelationEqual</span></span><br><span class="line">                                            toItem:keyBoardRowView</span><br><span class="line">                                            attribute:<span class="built_in">NSLayoutAttributeBottom</span></span><br><span class="line">                                            multiplier:<span class="number">1.0</span> constant:-space];</span><br><span class="line">    <span class="comment">// è¡Œé¦–buttonä¸keyboardViewå·¦ä¾§å¯¹é½ï¼Œä¹‹åçš„ä¸å·¦é‚»buttonå³è¾¹ç¼˜å¯¹é½</span></span><br><span class="line">    <span class="keyword">id</span> toItem = keyBoardRowView;</span><br><span class="line">    <span class="built_in">NSLayoutAttribute</span> toItemAttribute = <span class="built_in">NSLayoutAttributeLeft</span>;</span><br><span class="line">    <span class="keyword">if</span> (index &gt; <span class="number">0</span>)&#123;</span><br><span class="line">      toItem = buttons[index - <span class="number">1</span>];</span><br><span class="line">      toItemAttribute = <span class="built_in">NSLayoutAttributeRight</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">NSLayoutConstraint</span> *leftConstraint = [<span class="built_in">NSLayoutConstraint</span></span><br><span class="line">                                          constraintWithItem:button</span><br><span class="line">                                          attribute:<span class="built_in">NSLayoutAttributeLeft</span></span><br><span class="line">                                          relatedBy:<span class="built_in">NSLayoutRelationEqual</span></span><br><span class="line">                                          toItem:toItem</span><br><span class="line">                                          attribute:toItemAttribute</span><br><span class="line">                                          multiplier:<span class="number">1.0</span> constant:space];</span><br><span class="line">    <span class="comment">// è¡Œæœ«buttonä¸keyboardViewå³ä¾§å¯¹é½ï¼Œä¹‹å‰çš„ä¸å³é‚»buttonå·¦è¾¹ç¼˜å¯¹é½</span></span><br><span class="line">    toItem = keyBoardRowView;</span><br><span class="line">    toItemAttribute = <span class="built_in">NSLayoutAttributeRight</span>;</span><br><span class="line">    <span class="keyword">if</span>(index &lt; buttons.count - <span class="number">1</span>)&#123;</span><br><span class="line">      toItem = buttons[index + <span class="number">1</span>];</span><br><span class="line">      toItemAttribute = <span class="built_in">NSLayoutAttributeLeft</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">NSLayoutConstraint</span> *rightConstraint = [<span class="built_in">NSLayoutConstraint</span></span><br><span class="line">                                           constraintWithItem:button</span><br><span class="line">                                           attribute:<span class="built_in">NSLayoutAttributeRight</span></span><br><span class="line">                                           relatedBy:<span class="built_in">NSLayoutRelationEqual</span></span><br><span class="line">                                           toItem:toItem</span><br><span class="line">                                           attribute:toItemAttribute</span><br><span class="line">                                           multiplier:<span class="number">1.0</span> constant:-space];</span><br><span class="line">    <span class="comment">// æ¯ä¸ªæŒ‰é”®éƒ½ç­‰å®½</span></span><br><span class="line">    <span class="built_in">UIButton</span> *firstButton = buttons[<span class="number">0</span>];</span><br><span class="line">    <span class="built_in">NSLayoutConstraint</span> *widthConstraint = [<span class="built_in">NSLayoutConstraint</span></span><br><span class="line">                                           constraintWithItem:firstButton</span><br><span class="line">                                           attribute:<span class="built_in">NSLayoutAttributeWidth</span></span><br><span class="line">                                           relatedBy:<span class="built_in">NSLayoutRelationEqual</span></span><br><span class="line">                                           toItem:button</span><br><span class="line">                                           attribute:<span class="built_in">NSLayoutAttributeWidth</span></span><br><span class="line">                                           multiplier:<span class="number">1.0</span> constant:<span class="number">0</span>];</span><br><span class="line">    [keyBoardRowView addConstraint:widthConstraint];</span><br><span class="line">    [keyBoardRowView addConstraints:@[topConstraint,bottomConstraint,rightConstraint,leftConstraint]];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> keyBoardRowView;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿è¡Œåèƒ½çœ‹åˆ°é”®ç›˜å¸ƒå±€å¦‚ä¸‹ï¼š<br><img src="/2017/03/11/2017/0311iOSCKImeSample/img03.png" alt="é”®ç›˜å¸ƒå±€"></p>
<h1 id="Step2-æŒ‡å®šé”®ç›˜å“åº”å‡½æ•°"><a href="#Step2-æŒ‡å®šé”®ç›˜å“åº”å‡½æ•°" class="headerlink" title="Step2 æŒ‡å®šé”®ç›˜å“åº”å‡½æ•°"></a>Step2 æŒ‡å®šé”®ç›˜å“åº”å‡½æ•°</h1><p>åœ¨Step1.2åˆ›å»ºæ¯ä¸ªæŒ‰é”®åï¼Œè°ƒç”¨addTargetä¸ºä¹‹æŒ‡å®šå“åº”å‡½æ•°<code>didTapButton:</code><br><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)didTapButton:(<span class="built_in">UIButton</span>*)sender&#123;</span><br><span class="line">  <span class="comment">//è·å–è¢«ç‚¹å‡»æŒ‰é’®çš„title</span></span><br><span class="line">  <span class="built_in">NSString</span> *title = [sender titleForState:(<span class="built_in">UIControlStateNormal</span>)];</span><br><span class="line">  <span class="keyword">if</span>([title caseInsensitiveCompare:<span class="string">@"shift"</span>] == <span class="built_in">NSOrderedSame</span>)&#123;</span><br><span class="line">    <span class="keyword">self</span>.isPressShiftKey = !<span class="keyword">self</span>.isPressShiftKey;</span><br><span class="line">    [<span class="keyword">self</span> onShift]; <span class="comment">// åˆ‡æ¢å¤§å°å†™</span></span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span>([title caseInsensitiveCompare:<span class="string">@"bksp"</span>] == <span class="built_in">NSOrderedSame</span>)&#123;</span><br><span class="line">    [<span class="keyword">self</span>.textDocumentProxy deleteBackward];</span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span>([title caseInsensitiveCompare:<span class="string">@"space"</span>] == <span class="built_in">NSOrderedSame</span>)&#123;</span><br><span class="line">    [<span class="keyword">self</span>.textDocumentProxy insertText:<span class="string">@" "</span>];</span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span>([title caseInsensitiveCompare:<span class="string">@"return"</span>] == <span class="built_in">NSOrderedSame</span>)&#123;</span><br><span class="line">    [<span class="keyword">self</span>.textDocumentProxy insertText:<span class="string">@"\n"</span>];</span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span>([title caseInsensitiveCompare:<span class="string">@"next"</span>] == <span class="built_in">NSOrderedSame</span>)&#123;</span><br><span class="line">    [<span class="keyword">self</span> advanceToNextInputMode];</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    [<span class="keyword">self</span>.textDocumentProxy insertText:title];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)onShift&#123;</span><br><span class="line">  <span class="comment">// éå†æ¯ä¸€ä¸ªæŒ‰é”®ï¼Œåˆ‡æ¢é”®å¸½å¤§å°å†™</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="built_in">UIButton</span> *button <span class="keyword">in</span> <span class="keyword">self</span>.allButtons) &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *title = [button titleForState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.isPressShiftKey) &#123;</span><br><span class="line">      title = [title uppercaseString];</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      title = [title lowercaseString];</span><br><span class="line">    &#125;</span><br><span class="line">    [button setTitle:title forState:(<span class="built_in">UIControlStateNormal</span>)];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å‚è§<a href="http://localhost:4000/2017/03/07/2017/0307CustomKeyboard/#è‡ªå®šä¹‰é”®ç›˜API" target="_blank" rel="noopener">ã€Šè‡ªå®šä¹‰é”®ç›˜ä¹‹ï¼šè‡ªå®šä¹‰é”®ç›˜APIã€‹</a>ï¼Œè¿™é‡Œæœ‰é”®ç›˜ä¸è¾“å…¥å¯¹è±¡ä¹‹é—´äº¤äº’çš„APIï¼Œè¿™ä¹Ÿæ˜¯è¾“å…¥æ³•å¤„ç†æŒ‰é”®ä¸»è¦è°ƒç”¨çš„APIã€‚</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>åˆ°æ­¤ä¸€ä¸ªç®€å•çš„å¯å¤„ç†æŒ‰é”®äº‹ä»¶çš„è‡ªå®šä¹‰é”®ç›˜å°±å®Œæˆäº†ã€‚å’ŒWindowsçš„IMMæ¡†æ¶ç›¸æ¯”ï¼ŒiOSçš„Custom Keyboardä½“ç³»è®©è¾“å…¥æ³•èƒ½æœ€å°åŒ–è¿è¡Œèµ·æ¥ï¼Œè¦ç®€å•å¤ªå¤šäº†ã€‚æˆ‘åˆ†æåŸå› å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ‰‹æœºä¸Šçš„æŒ‰é”®è¾“å…¥äº‹ä»¶æ¥è‡ªé”®ç›˜ç•Œé¢ï¼›è€ŒWindowsçš„IMMåˆ™æ¥è‡ªç³»ç»Ÿï¼Œå› æ­¤Windowsé¡»å®šä¹‰ä¸€å¥—åè®®è®©æŒ‰é”®ä»IMMä¼ é€’ç»™è¾“å…¥æ³•ï¼Œè¿™å°±æ˜¯é‚£åå‡ ä¸ªImexxxçš„å¯¼å‡ºå‡½æ•°ã€‚</li>
<li>è€Œä¸”Windowså¤„ç†æ¯ä¸ªæŒ‰é”®ä¸æ˜¯ä¸€ä¸ªå¯¼å‡ºå‡½æ•°å°±èƒ½å®Œæˆï¼Œè€Œéœ€è¦<code>ImeProcessKey</code>å’Œ<code>ImeToAsciiEx</code>ä¸¤æ¬¡è°ƒç”¨ï¼Œè¿™æ˜¯æˆ‘ä¸€ç›´ä¸ç†è§£çš„åœ°æ–¹ã€‚</li>
<li>iOSä¸‹å¤„ç†æŒ‰é”®æ˜¯ç”±é”®ç›˜è§†å›¾é©±åŠ¨ï¼Œå¤„ç†å®Œæˆåç›´æ¥è°ƒç”¨è§†å›¾æ–¹æ³•æ›´æ–°ç•Œé¢ï¼›è€ŒWindowså¤„ç†å®ŒæŒ‰é”®ä¹‹åï¼Œä¸èƒ½ç›´æ¥è°ƒç”¨ç•Œé¢æ›´æ–°ï¼Œè€Œæ˜¯æŠŠå¾…æ›´æ–°çš„å†…å®¹è½¬æ¢æˆæ¶ˆæ¯ï¼Œé€šçŸ¥è¾“å…¥æ³•UIçª—å£ï¼ŒUIçª—å£å†æŠŠæ¶ˆæ¯ç¿»è¯‘æˆæ›´æ–°çš„å†…å®¹å±•ç°åˆ°å­çª—å£ä¸Šã€‚è¿™ç›¸å½“äºç³»ç»Ÿæœ‰å®šä¹‰äº†ä¸€å±‚WM_IME_xxxçš„æ¶ˆæ¯åè®®ã€‚ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥æ§åˆ¶ç•Œé¢å‘¢ï¼Ÿåº”è¯¥æ˜¯æ€•å¡æ­»ä¸»è¿›ç¨‹ï¼Œè¯•æƒ³ä¸€èˆ¬çš„Windows UIç¨‹åºï¼Œå‡è®¾è¦å®šæ—¶åˆ·æ–°ç•Œé¢ï¼Œä¸æ˜¯åœ¨å®šæ—¶å™¨é‡Œç›´æ¥ç»˜åˆ¶ï¼Œè€Œæ˜¯åœ¨å®šæ—¶å™¨é‡Œè®¾ç½®æ— æ•ˆåŒºåŸŸï¼Œåœ¨WM_PAINTæ¶ˆæ¯ä¸­å¤„ç†ç»˜åˆ¶ã€‚</li>
<li>Windowsçš„IMCæ˜¯æ¯çº¿ç¨‹ä¸€ä»½ï¼Œè¿™ä¹ˆåšçš„å¥½å¤„æ˜¯åœ¨ä¸åŒçš„è¿›ç¨‹æˆ–çº¿ç¨‹ä¹‹é—´åˆ‡æ¢ç„¦ç‚¹ï¼Œå¯ä»¥ä¿æŒä¸Šæ¬¡çš„è¾“å…¥çŠ¶æ€å’Œå†…å®¹ï¼Œä½†ä¹Ÿè®©æ•°æ®å’Œå¯¹è¿™äº›æ•°æ®çš„å¤„ç†å¿…é¡»åˆ†ç¦»å¼€ï¼›è€ŒiOSçš„ä¸Šä¸‹æ–‡ä¿¡æ¯åˆ™ä¸è¾“å…¥appæ— å…³ï¼Œå½“è¾“å…¥ç„¦ç‚¹åˆ‡æ¢ï¼Œä¸Šä¸‹æ–‡ä¿¡æ¯ä¹Ÿå°±ä¸¢å¤±äº†ã€‚è¿™ä¹ˆåšçš„å¥½å¤„æ˜¯è¾“å…¥æ³•ä¸å¿…è´Ÿè´£æ ¹æ®ä¸Šä¸‹æ–‡æ¢å¤å½“å‰çŠ¶æ€ï¼Œçœå»äº†é€»è¾‘çš„å¤æ‚æ€§ã€‚å½“ç„¶ï¼Œå¦‚æœåœ¨Windowsä¸‹çŠ¶æ€æœºåšå¾—æ¼‚äº®ï¼Œè¿™ä¸ªå¤æ‚åº¦å€’ä¹Ÿä¸å¤§ï¼Œè¿™éœ€è¦ä»˜å‡ºæ›´å¤§çš„è®¾è®¡æˆæœ¬ã€‚</li>
<li>iOSåº•å±‚ä¸€å®šæœ‰æ›´ä¾¿åˆ©çš„è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ï¼Œè®©è¾“å…¥æ³•å¯ä»¥å’Œè¾“å…¥è¿›ç¨‹é€šä¿¡ï¼›è¿™æ˜¯Windowsæ‰€ä¸å…·å¤‡çš„ã€‚iOSè¿™ä¸ªæœºåˆ¶è®©è¾“å…¥æ³•æ›´æ–¹ä¾¿ã€å‡†ç¡®åœ°è·å¾—è¾“å…¥ä¸Šä¸‹æ–‡ï¼Œä»è€Œå¯ä»¥æä¾›æ›´å¥½çš„è”æƒ³å€™é€‰ã€‚</li>
</ul>
<p>åè®®ä¸ºä¸¤ä¸ªæ¨¡å—ä¹‹é—´çš„äº¤äº’æä¾›äº†ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œä½¿å¾—ä¸¤ä¸ªæ¨¡å—ä¹‹é—´è§£é™¤äº†è€¦åˆï¼Œä½†åŒæ—¶ä¹Ÿå¢åŠ äº†å­¦ä¹ æˆæœ¬ï¼Œå¦‚æœåŸæœ¬å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œå…¶å†…éƒ¨è°ƒç”¨ä¹Ÿç”¨åè®®æ¥éš”ç¦»ï¼Œé‚£å°±ä¼šæŠŠäº‹æƒ…å¤æ‚åŒ–ã€‚Windowsçš„Imexxxå¯¼å‡ºå‡½æ•°è¿™å±‚åè®®æ˜¯å¿…è¦çš„ï¼Œä½†è¿™åå‡ ä¸ªå‡½æ•°ä¸­å¿…é¡»çš„ä¹Ÿå°±å››äº”ä¸ªï¼Œå…¶å®ƒå¤§éƒ¨åˆ†ç”¨ä¸åˆ°ï¼›WM_IME_xxxè¿™å±‚åè®®å°±æŠŠäº‹æƒ…å¼„å¤æ‚äº†ï¼Œä½†åˆä¸å¾—ä¸è¿™ä¹ˆåšã€‚Windowsæ¯çº¿ç¨‹ä¸€ä»½çš„IMCå´å¯¹è®¾è®¡æå‡ºæ›´é«˜çš„è¦æ±‚ï¼Œå¹¶æ²¡æœ‰å¸¦æ¥å¤šå¤§çš„å¥½å¤„ï¼Œï¼Œæ¯”å¦‚macOSä¸‹ä¹Ÿæ²¡æœ‰åŸºäºè¿›ç¨‹æˆ–çº¿ç¨‹çš„è¾“å…¥ä¸Šä¸‹æ–‡ï¼Œä¹Ÿä¸è§‰å¾—ç¼ºæ†¾ã€‚ä»¥ä¸Šå°±æ˜¯Windowsçš„IMMæ¡†æ¶æ¯”iOSå¤æ‚çš„åŸå› ã€‚</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/è¾“å…¥æ³•/" rel="tag"># è¾“å…¥æ³•</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/03/07/2017/0307CustomKeyboard/" rel="next" title="iOSä¸‹çš„è‡ªå®šä¹‰é”®ç›˜ï¼ˆè¯‘ï¼‰">
                <i class="fa fa-chevron-left"></i> iOSä¸‹çš„è‡ªå®šä¹‰é”®ç›˜ï¼ˆè¯‘ï¼‰
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/03/23/2017/0323macOSIMKSample2/" rel="prev" title="macOSä¸‹åŸºäºIMKçš„è¾“å…¥æ³•ï¼ˆäºŒï¼‰â€”â€”å¤„ç†æµç¨‹">
                macOSä¸‹åŸºäºIMKçš„è¾“å…¥æ³•ï¼ˆäºŒï¼‰â€”â€”å¤„ç†æµç¨‹ <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div class="ds-thread" data-thread-key="2017/03/11/2017/0311iOSCKImeSample/" data-title="iOSä¸‹å¼€å‘Custom Keyboard" data-url="http://palanceli.github.io/2017/03/11/2017/0311iOSCKImeSample/">
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://avatars0.githubusercontent.com/u/13184524" alt="Palance Li">
            
              <p class="site-author-name" itemprop="name">Palance Li</p>
              <p class="site-description motion-element" itemprop="description">å­¦ä¹ ï¼Œé‡ç”Ÿ</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">215</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">33</span>
                  <span class="site-state-item-name">åˆ†ç±»</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">62</span>
                  <span class="site-state-item-name">æ ‡ç­¾</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/palanceli" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:palanceli@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="http://blog.csdn.net/zchongr" target="_blank" title="æˆ‘çš„CSDN">
                      
                        <i class="fa fa-fw fa-globe"></i>æˆ‘çš„CSDN</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="http://www.cnblogs.com/palance/" target="_blank" title="æˆ‘çš„åšå®¢å›­">
                      
                        <i class="fa fa-fw fa-globe"></i>æˆ‘çš„åšå®¢å›­</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="http://www.jianshu.com/" target="_blank" title="æˆ‘çš„ç®€ä¹¦">
                      
                        <i class="fa fa-fw fa-globe"></i>æˆ‘çš„ç®€ä¹¦</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#åœ¨å®¹å™¨appä¸­æ·»åŠ å¯è¾“å…¥å¯¹è±¡"><span class="nav-number">1.</span> <span class="nav-text">åœ¨å®¹å™¨appä¸­æ·»åŠ å¯è¾“å…¥å¯¹è±¡</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Xcodeæ¨¡æ¿ç”Ÿæˆçš„é”®ç›˜"><span class="nav-number">2.</span> <span class="nav-text">Xcodeæ¨¡æ¿ç”Ÿæˆçš„é”®ç›˜</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Step1-åˆ›å»ºæŒ‰é”®å¸ƒå±€"><span class="nav-number">3.</span> <span class="nav-text">Step1 åˆ›å»ºæŒ‰é”®å¸ƒå±€</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Step1-1-createCKbdUI"><span class="nav-number">3.1.</span> <span class="nav-text">Step1.1 createCKbdUI</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Step1-2-createRowOfButtons"><span class="nav-number">3.2.</span> <span class="nav-text">Step1.2 createRowOfButtons</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Step2-æŒ‡å®šé”®ç›˜å“åº”å‡½æ•°"><span class="nav-number">4.</span> <span class="nav-text">Step2 æŒ‡å®šé”®ç›˜å“åº”å‡½æ•°</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#æ€»ç»“"><span class="nav-number">5.</span> <span class="nav-text">æ€»ç»“</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Palance Li</span>

  
</div>


  <div class="powered-by">ç”± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"palanceli"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  


















  





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="custom_mathjax_source">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
  


  

  

</body>
</html>
